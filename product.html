<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title> Rongtulis-Product Detail</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
 <style>
  /* predictable sizing */
  *, *::before, *::after { box-sizing: border-box; }

  :root{
    --card:#fff;
    --accent:#6aa8d6;
    --accent-dark:#6aa8d6;
    --muted:#7b8794;
    --text:#7092b0;
    --radius:14px;
    --card-radius:12px;
    --shadow:0 8px 26px rgba(16,24,40,0.06);
    --soft-shadow:0 6px 18px rgba(15,30,40,0.06);
    --cart-width:340px;

    /* positioning controls */
    --cart-offset-desktop: 60px;       /* desktop: right offset for cart & toggle */
    --cart-offset-mobile-right: 12px;  /* mobile: right gap for toggle */
    --cart-offset-mobile-left: 40px;   /* mobile: left inset for panel (keeps it away from left edge) */

    /* reserve space for the floating toggle on mobile so it won't overlap the cart */
    --toggle-width: 92px;              /* adjust if your cart-toggle grows/shrinks */
    --toggle-gap: 8px;                 /* space between toggle and cart */

    /* animation timing */
    --anim-fast: 180ms;
    --anim-med: 420ms;
    --anim-slow: 900ms;
    --easing: cubic-bezier(.2,.9,.2,1);
  }

  /* page base */
  body{
    font-family: Inter, system-ui, Arial, sans-serif;
    margin:0;
    background:#f6f8fb;
    color:var(--text);
  }

  /* subtle moving overlay to keep the page feeling alive */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(120deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00) 30%, rgba(0,0,0,0.01));
    mix-blend-mode: overlay;
    opacity: 0.9;
    animation: bgShift 18s linear infinite;
    z-index: 0;
  }
  @keyframes bgShift {
    0% { transform: translateX(-6%); }
    50% { transform: translateX(6%); }
    100% { transform: translateX(-6%); }
  }

  .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
  .top{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;}
  .gallery{width:46%;background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow)}
  .thumbs{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap; position:relative;}
  /* thumbnails: start hidden via css, they will fade in when .in is added. */
  .thumbs img{width:70px;height:70px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid transparent;opacity:0;transform:translateY(8px) scale(.995); transition: transform var(--anim-med) var(--easing), opacity var(--anim-med) var(--easing); }
  .thumbs img.active{border-color:var(--accent)}
  .thumb-overlay {
    position:absolute;
    right:0;
    top:0;
    width:70px;
    height:70px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.45);
    color:#fff;
    font-weight:800;
    cursor:pointer;
    font-size:13px;
    user-select:none;
  }
  .thumbs img.in { opacity:1; transform: translateY(0) scale(1); }

  .info{flex:1;background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(10px);}
  .price{font-weight:800;color:var(--accent);font-size:20px;margin-top:6px}
  .add-row{display:flex;gap:8px;margin-top:12px;align-items:center;flex-wrap:wrap}
  .qty{display:flex;align-items:center;gap:8px;background:#f1f6fb;padding:6px;border-radius:8px}
  .qty button{border:0;background:transparent;cursor:pointer;font-weight:700;padding:6px 8px}
  .btn-add{background:linear-gradient(180deg,var(--accent),var(--accent-dark));color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;width:auto;white-space:nowrap;}
  footer{max-width:1000px;margin:28px auto;text-align:center;color:var(--muted)}

  /* --- CART TOGGLE --- */
  #cart-toggle {
    position: fixed;
    right: var(--cart-offset-desktop);
    top: 22px;
    background: var(--accent);
    color: #fff;
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.12);
    cursor: pointer;
    z-index: 12000;
    display: flex;
    align-items: center;
    gap: 6px;
    border: none;
    transition: all 0.18s ease;
    transform-origin: center;
  }
  #cart-toggle:hover { background: var(--accent-dark); transform: translateY(-2px); }
  #cart-toggle .count { background: #fff; color: var(--accent-dark); padding: 2px 8px; border-radius: 999px; font-weight: 700; font-size: 12px; }

  /* cart panel (block layout) */
  #cart {
    position: fixed;
    right: var(--cart-offset-desktop);
    top: 70px;
    width: var(--cart-width);
    max-width: calc(100% - 40px);
    max-height: calc(100vh - 96px);
    overflow-y: auto;
    overflow-x: hidden;
    background: #fff;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.12);
    z-index: 11000;
    transition: transform 0.22s ease, opacity 0.22s ease;
    display: block;
    -webkit-overflow-scrolling: touch;
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  #cart.hidden { transform: translateY(-10px) scale(0.98); opacity: 0; pointer-events: none; display: none; }

  /* animate cart open/close */
  #cart.anim-in { transform: translateY(0) scale(1); opacity: 1; transition: transform var(--anim-fast) var(--easing), opacity var(--anim-fast) var(--easing); }
  #cart.anim-out { transform: translateY(-8px) scale(.99); opacity: 0; transition: transform var(--anim-fast) var(--easing), opacity var(--anim-fast) var(--easing); }

  /* Default cart text styles */
  #cart h2 { margin: 0 0 12px 0; font-size: 18px; color: #143047; }
  #cart p { margin: 8px 0; font-weight: 700; color: #143047; }

  /* cart rows */
  #cart-rows > .cart-row {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    margin-bottom: 6px;
    flex-wrap: wrap; /* allow wrap so controls drop below on narrow screens */
    min-height: 56px;
    opacity: 1;
  }
  #cart-rows > .cart-row:last-child { border-bottom: none; margin-bottom: 0; }

  #cart .cart-img { width: 56px; height: 56px; object-fit: cover; border-radius: 8px; flex: 0 0 56px; background: #f2f4f6; }

  #cart .cart-text { flex: 1 1 auto; min-width: 0; }
  #cart .cart-text > div:first-child { font-weight: 800; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #143047; }
  #cart .cart-text > div:last-child { font-size: 13px; color: var(--muted); margin-top: 4px; }

  #cart .cart-controls { display: flex; flex-direction: column; gap: 6px; align-items: flex-end; flex: 0 0 auto; margin-left: 8px; }

  .small-btn { background: transparent; border: 1px solid rgba(16,24,40,0.06); padding: 6px 8px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 13px; }
  .small-btn.icon { min-width:36px; padding:6px 10px; text-align:center; }
  .small-btn:active { transform: translateY(1px); }

  /* footer layout: checkout + close button (close moved here) */
  .cart-footer { margin-top: 12px; display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
  .cart-footer .checkout-wrap { flex: 1 1 100%; }
  #checkout-btn { background: linear-gradient(180deg,var(--accent),var(--accent-dark)); color: white; border: none; padding: 12px 14px; border-radius: 10px; cursor: pointer; font-weight: 800; width: 70%; box-shadow: 0 8px 18px rgba(106,168,214,0.16); }
  #cart-close-footer { background: transparent; border: 1px solid rgba(16,24,40,0.08); padding: 12px 14px; border-radius: 10px; cursor: pointer; font-weight: 700; color: #143047; white-space: nowrap; }

  #subtotal, #shipping, #total { margin: 8px 0; font-weight: 600; color: var(--muted); font-size: 14px; }
  #total { color: #143047; font-size: 16px; }

  /* ensure no horizontal scroll inside cart */
  #cart { overflow-y: auto; overflow-x: hidden; }

  /* --------------------------
     MOBILE: reserve toggle space and align cart
     -------------------------- */
  @media (max-width: 900px) {
    .top { flex-direction: column; align-items: center; }
    .gallery, .info { width: 100%; box-sizing: border-box; }
    .gallery img { max-height: 260px; }
    .thumbs img { width: 60px; height: 60px; }

    .add-row { flex-direction: column; align-items: stretch; }
    .qty { justify-content: center; }
    .btn-add { width: 100%; text-align: center; }

   #cart {
      right: 12px;
      width: calc(100% - 24px);
      top: auto;
      bottom: 90px;
    }
    #cart-toggle {
      top: auto;
      bottom: 22px;
      right: var(--cart-offset-mobile-right);
      padding: 12px 16px;
      z-index: 13000;
      width: var(--toggle-width);
      justify-content: center;
    }

    .cart-footer { gap: 10px; }
    .cart-footer .checkout-wrap { flex: 1 1 100%; }
    #checkout-btn { width: 100%; }
    #cart-close-footer { width: 100%; }
  }

  @media (max-width: 600px) {
    body { font-size: 15px; }
    .wrap { padding: 0 12px; }
    .gallery img { max-height: 200px; }
    .thumbs img { width: 52px; height: 52px; }
    #cart { padding: 12px; max-height: calc(100vh - 110px); }

    #cart .cart-row { gap: 10px; padding: 8px 0; min-height: 48px; }
    #cart .cart-img { width: 48px; height: 48px; flex: 0 0 48px; }
    .small-btn { padding: 6px 6px; font-size: 12px; }

    /* controls become horizontal under the text */
    #cart .cart-controls {
      width: 100%;
      margin-left: 0;
      align-items: flex-start;
      flex-direction: row;
      gap: 8px;
      justify-content: flex-start;
      flex-wrap: wrap;
      margin-top: 8px;
    }
  }

  @media (max-width: 400px) {
    .product-card { padding: 10px; }
    .product-image { height: 120px; }
    .btn-add { font-size: 14px; padding: 8px; }
    #cart h2 { font-size: 16px; }
    #cart .cart-text > div:first-child { font-size: 13px; }
    #checkout-btn { padding: 10px 12px; font-size: 15px; }
    #cart-close-footer { padding: 10px 12px; font-size: 14px; }
  }

   .header {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem 0;
  }

      .logo { height: 90px; max-width: 100%; }

 /* Keep desktop look even on mobile */
.navbar {
  background-color: #dce4cc;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: nowrap; /* stop breaking into multiple lines */
  gap: 1.5rem;
  padding: 0.7rem 1rem;
  border-radius: 13px;
  margin: 0 auto;
  width: fit-content;
  overflow-x: auto; /* allow horizontal scroll if needed */
  scrollbar-width: none; /* hide scrollbar (Firefox) */
  -ms-overflow-style: none; /* hide scrollbar (IE/Edge) */
}
.navbar::-webkit-scrollbar { display: none; } /* hide scrollbar (Chrome/Safari) */

.navbar a {
  text-decoration: none;
  font-weight: 600;
  color: #415a4a;
  font-size: 1rem;
  transition: color 0.2s ease;
}

/* hover + visited fix */
.navbar a:hover {
  color: #2f4436;
}
.navbar a:visited,
.navbar a:active,
.navbar a:focus {
  color: #415a4a;
  text-decoration: none;
}

/* Optional: reduce gap slightly on smaller screens */
@media (max-width: 500px) {
  .navbar {
    gap: 1rem;
    padding: 0.6rem 0.8rem;
  }
  .navbar a {
    font-size: 0.9rem;
  }
}


 /* AI search promo block (place before footer) */
.ai-promo {
  background: #fff;
  border-radius: 12px;
  padding: 18px;
  margin: 28px auto;
  box-shadow: 0 10px 30px rgba(16,24,40,0.06);
  max-width: 970px;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  border: 1px solid #eef6fb;

  /* start hidden until product content has animated in */
  opacity: 0;
  transform: translateY(8px);
}
.ai-promo.in { opacity: 1; transform: translateY(0); transition: opacity var(--anim-med) var(--easing), transform var(--anim-med) var(--easing); }

.ai-promo .left {
  display: flex;
  gap: 12px;
  align-items: center;
}
.ai-promo .left .icon {
  width: 56px;
  height: 56px;
  border-radius: 10px;
  background:#6aa7d628;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: #7092b0;
  font-size: 20px;
  transform-origin: center;
  animation: aiPulse var(--anim-slow) var(--easing) infinite;
}
@keyframes aiPulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.04); opacity: 0.94; }
  100% { transform: scale(1); opacity: 1; }
}
.ai-promo h3 { margin: 0; font-size: 16px; font-weight: 800; color:#7092b0; }
.ai-promo p { margin: 2px 0 0 0; color:var(--muted); font-size:13px; }
.ai-promo .ai-btn {
  background: #6aa8d6;
  color: #fff;
  border: 0;
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 8px 18px rgba(106,168,214,0.16);
}

/* thumbnails & gallery entrance helpers */
.gallery .main-img { opacity: 0; border-radius: 10px;transform: translateY(8px) scale(.998); transition: transform var(--anim-med) var(--easing), opacity var(--anim-med) var(--easing); }
.gallery .main-img.in { opacity: 1; transform: translateY(0) scale(1); }

/* thumbnails appear in a small stagger */
.thumbs img.in { opacity: 1; transform: translateY(0) scale(1); transition: transform var(--anim-med) var(--easing), opacity var(--anim-med) var(--easing); }

/* info area entrance */
.info.in { opacity: 1; transform: translateY(0); transition: transform var(--anim-med) var(--easing), opacity var(--anim-med) var(--easing); }

/* product-exit (page-level fade) */
.page-exit .wrap,
.page-exit .navbar,
.page-exit .header,
.page-exit .ai-promo,
.page-exit #product-area {
  opacity: 0;
  transform: translateY(-8px) scale(.997);
  transition: opacity var(--anim-fast) var(--easing), transform var(--anim-fast) var(--easing);
}

/* navbar link stagger in */
.navbar a { opacity: 0; transform: translateY(6px); display:inline-block; }
.navbar.ready a { animation: navIn var(--anim-med) var(--easing) forwards; }
.navbar.ready a:nth-child(1){ animation-delay: 80ms; }
.navbar.ready a:nth-child(2){ animation-delay: 160ms; }
.navbar.ready a:nth-child(3){ animation-delay: 240ms; }
@keyframes navIn{ to { opacity:1; transform:translateY(0); } }

/* cart-toggle bump */
#cart-toggle.bump { animation: cartBump 700ms cubic-bezier(.2,.9,.2,1); }
@keyframes cartBump {
  0% { transform: scale(1); }
  25% { transform: scale(1.18) translateY(-3px); }
  60% { transform: scale(.96) translateY(0); }
  100% { transform: scale(1); }
}

/* image shimmer while loading */
.product-image[data-loading="true"] {
  position: relative;
  overflow: hidden;
}
.product-image[data-loading="true"]::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0) 100%);
  transform: translateX(-110%);
  animation: shimmer 1200ms linear infinite;
}
@keyframes shimmer { to { transform: translateX(110%); } }

/* ---------------------------
   POPUP VIEWER STYLES (centered card, matching site) 
   --------------------------- */
#fs-viewer {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 22000;
}
#fs-viewer.visible { display:flex; }
#fs-viewer .fs-bg { position:absolute; inset:0; background: rgba(12,18,25,0.48); backdrop-filter: blur(4px); }
#fs-viewer .fs-card {
  position: relative;
  width: min(880px, 94%);
  max-height: 88vh;
  background: var(--card);
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 22px 60px rgba(15,30,40,0.28);
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
}
#fs-viewer img { max-width:100%; max-height:72vh; border-radius:10px; display:block; }
.fs-close, .fs-prev, .fs-next {
  position: absolute;
  background: transparent;
  border: none;
  color: #143047;
  font-size: 26px;
  cursor: pointer;
  padding: 6px;
  line-height: 1;
}
.fs-close { top: 12px; right: 12px; font-size: 24px; color:#6a7a88; }
.fs-prev { left: 12px; top: 50%; transform: translateY(-50%); font-size:28px; color:#6a7a88; }
.fs-next { right: 12px; top: 50%; transform: translateY(-50%); font-size:28px; color:#6a7a88; }

/* thumbnail within popup (optional) */
.fs-thumbs { display:flex; gap:8px; margin-top:12px; justify-content:center; flex-wrap:wrap; }
.fs-thumbs img { width:64px; height:64px; object-fit:cover; border-radius:8px; cursor:pointer; border:2px solid transparent; }
.fs-thumbs img.active { border-color:var(--accent); }

/* ---------------------------
   NEW: "More products" UI styles
   (keeps visual language consistent)
   --------------------------- */
.more-section {
  margin: 26px auto;
  max-width: 1000px;
  background: transparent;
  padding: 12px;
  border-radius: 12px;
}

/* controls row */
.more-controls {
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:12px;
  flex-wrap:wrap;
}
.more-controls .tab {
  background:#fff;
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
  font-weight:700;
  box-shadow: var(--soft-shadow);
  border:1px solid transparent;
  transition: all 220ms var(--easing);
}
.more-controls .tab.active {
  background: linear-gradient(180deg,var(--accent),var(--accent-dark));
  color:#fff;
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(106,168,214,0.12);
}

/* product grid for "more" */
.more-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* leave as-is */
  gap: 12px;
  justify-content: center; /* center the tracks so cards don't hug the edges */
  align-items: start;
}

/* force cards to look like normal cards even when only one present */
.more-card {
  width: 220px;        /* fixed visual card width */
  max-width: 100%;     /* keep mobile-friendly */
  margin: 0 auto;      /* center the card inside a stretched grid cell */
  background: #fff;
  border-radius: 12px;
  padding: 10px;
  box-shadow: var(--soft-shadow);
  cursor: pointer;
  display:flex;
  flex-direction:column;
  gap:8px;
  transform: translateY(12px);
  opacity: 0;
  transition: transform var(--anim-med) var(--easing), opacity var(--anim-med) var(--easing);
}

.more-card.in { transform: translateY(0); opacity: 1; }
.more-card .thumb {
  height:120px;
  border-radius:8px;
  overflow:hidden;
  background:#f6f8fb;
  display:flex;
  align-items:center;
  justify-content:center;
}
.more-card .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
.more-card .title { font-weight:800; color:#7092b0; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.more-card .price { font-weight:800; color:var(--text); }

/* load-more control */
.more-footer { display:flex; justify-content:center; margin-top:12px; }
.more-footer .load-more {
  background:#fff; border:1px solid #e6eef7; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700;
  box-shadow: var(--soft-shadow);
}
.more-footer .load-more:active { transform: translateY(1px); }

.more-empty { padding:12px; color:var(--muted); background:#fff; border-radius:10px; box-shadow:var(--soft-shadow); }

/* reduce motion */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
  .thumbs img, .info, .gallery .main-img, .ai-promo, .more-card { opacity: 1 !important; transform: none !important; }
}
</style>

</head>
<body>


   <header class="header">
<a href="index.html">
  <img src="assets/logo.png" alt="Rongtuli Logo" class="logo" />
</a>  </header>

  <nav class="navbar">
    <a href="#">Sarees</a>
    <a href="#">Creams</a>
    <a href="#">Hair Bands</a>
    
  </nav>
  <div class="wrap">
<a href="#" 
   style="text-decoration:none;color:var(--muted)" 
   onclick="(function(e){
     e.preventDefault();
     try {
       // if there's a previous page in history -> go back
       if (history.length > 1) {
         history.back();
       } else {
         // fallback if opened directly / no history
         window.location.href = 'index.html';
       }
     } catch(err) {
       // fallback on error
       window.location.href = 'index.html';
     }
   })(event);">
  ← Go Back
</a>
    <div id="product-area" style="margin-top:12px">Loading product...</div>
  </div>

  <!-- Floating cart toggle + panel -->
  <button id="cart-toggle" aria-expanded="false" title="Open cart">Cart <span class="count">0</span></button>

  <div id="cart" class="hidden" aria-hidden="true">
    <h2>Your Cart</h2>

    <div id="cart-rows">Cart is empty.</div>

    <!-- footer: checkout then close button appears right after -->
    <div class="cart-footer">
      <div class="checkout-wrap">
        <p id="subtotal">Subtotal: QAR 0.00</p>
        <p id="shipping">Shipping: QAR 0.00</p>
        <p id="total">Total: QAR 0.00</p>
        <button id="checkout-btn">Checkout via WhatsApp</button>
     <button id="cart-close-footer" type="button">Close</button> </div>
      
    </div>
  </div>

  

  <!-- AI search promo: "Can't find what you want?" -->
<div class="ai-promo" id="aiPromo">
  <div class="left">
    <div class="icon">AI</div>
    <div>
      <h3>Can't find what you want?</h3>
      <p>Try our smart AI search — describe what you need in plain words and we’ll suggest products.</p>
    </div>
  </div>

  <div>
    <button class="ai-btn" id="openAISearch">Try AI Search</button>
  </div>
  
</div>

  <!-- NEW: More products interactive area -->
  <div class="more-section" id="moreSection" aria-live="polite">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px">
      <div class="more-controls" role="tablist" aria-label="More product views">
        <div class="tab active" data-view="category" role="tab" tabindex="0">More from this category</div>
        <div class="tab" data-view="trending" role="tab" tabindex="0">Trending</div>
        <div class="tab" data-view="suggested" role="tab" tabindex="0">You may like</div>
      </div>
    </div>

    <div id="moreGrid" class="more-grid" aria-live="polite" aria-atomic="true">
      <!-- cards injected here -->
    </div>

    <div class="more-footer">
      <button class="load-more" id="moreLoadBtn">Load more</button>
    </div>
  </div>

  <footer id="foot">© <span id="year"></span> Rongtuli</footer>

  <!-- POPUP VIEWER MARKUP -->
  <div id="fs-viewer" aria-hidden="true" role="dialog" aria-label="Image viewer">
    <div class="fs-bg" tabindex="-1"></div>
    <div class="fs-card" role="document">
      <button class="fs-close" aria-label="Close viewer">✕</button>
      <button class="fs-prev" aria-label="Previous image">‹</button>
      <img id="fs-img" alt="Product image in popup" src="" />
      <button class="fs-next" aria-label="Next image">›</button>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const SUPABASE_URL = 'https://qhslurjvanppitwuuxtv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoc2x1cmp2YW5wcGl0d3V1eHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NTg0MjEsImV4cCI6MjA3NjUzNDQyMX0.8PNOewgJFDGVVIDdiEbdFE2x9Yzv29o2kdAANqaW1gA';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const WHATSAPP_NUMBER = '97451707046';
    document.getElementById('year').textContent = new Date().getFullYear();

    // cart stored in localStorage
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    function saveCart(){
      localStorage.setItem('cart', JSON.stringify(cart));
      localStorage.setItem('cart_last_update', Date.now());
      renderCart();
      updateCartCount();
    }

    document.getElementById('openAISearch').addEventListener('click', function () {
      window.location.href = 'search.html';
    });
    // elements
    const cartToggle = document.getElementById('cart-toggle');
    const cartEl = document.getElementById('cart');
    const cartRows = document.getElementById('cart-rows');
    const subtotalEl = document.getElementById('subtotal');
    const shippingEl = document.getElementById('shipping');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const cartCloseFooter = document.getElementById('cart-close-footer');

    function formatPrice(n){ return 'QAR ' + (Number(n)||0).toFixed(2); }

    function updateCartCount(){
      const qty = cart.reduce((s,i)=> s + (Number(i.quantity)||0), 0);
      cartToggle.querySelector('.count').textContent = qty;
      cartToggle.setAttribute('aria-label', `Open cart — ${qty} items`);
    }

    function renderCart(){
      cartRows.innerHTML = '';
      if(!cart || cart.length === 0){
        cartRows.textContent = 'Cart is empty.';
      } else {
        cart.forEach((it, i) => {
          const row = document.createElement('div');
          row.className = 'cart-row';

          const img = document.createElement('img');
          img.className = 'cart-img';
          img.src = it.image || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect width="100%" height="100%" fill="%23eee"/></svg>';
          img.alt = it.name || 'product';

          const txt = document.createElement('div');
          txt.className = 'cart-text';
          const title = document.createElement('div');
          title.textContent = it.name || 'Product';
          const meta = document.createElement('div');
          meta.textContent = `${formatPrice(it.price)} × ${it.quantity}`;
          txt.appendChild(title);
          txt.appendChild(meta);

          const controls = document.createElement('div');
          controls.className = 'cart-controls';

          const inc = document.createElement('button');
          inc.className = 'small-btn icon';
          inc.textContent = '+';
          inc.addEventListener('click', (e) => { e.stopPropagation(); cart[i].quantity++; saveCart(); });

          const dec = document.createElement('button');
          dec.className = 'small-btn icon';
          dec.textContent = '-';
          dec.addEventListener('click', (e) => { e.stopPropagation(); if (cart[i].quantity > 1) cart[i].quantity--; else cart.splice(i,1); saveCart(); });

          const rem = document.createElement('button');
          rem.className = 'small-btn';
          rem.textContent = 'Remove';
          rem.addEventListener('click', (e) => { e.stopPropagation(); cart.splice(i,1); saveCart(); });

          controls.appendChild(inc);
          controls.appendChild(dec);
          controls.appendChild(rem);

          row.appendChild(img);
          row.appendChild(txt);
          row.appendChild(controls);

          cartRows.appendChild(row);
        });
      }

      const subtotal = cart.reduce((s,i)=> s + (Number(i.price)||0) * i.quantity, 0);
      const shipping = subtotal > 0 ? 10 : 0;
      subtotalEl.textContent = 'Subtotal: ' + formatPrice(subtotal);
      shippingEl.textContent = 'Shipping: ' + formatPrice(shipping);
      totalEl.textContent = 'Total: ' + formatPrice(subtotal + shipping);
    }

    // animate cart open/close (non-destructive, replaces direct show/hide)
    function animateCartOpen(){
      cartEl.classList.remove('hidden','anim-out');
      // force reflow so anim-in runs
      void cartEl.offsetWidth;
      cartEl.classList.add('anim-in');
      cartEl.style.display = 'block';
      cartEl.setAttribute('aria-hidden','false');
      cartToggle.setAttribute('aria-expanded','true');
      cartEl.scrollTop = 0;
    }
    function animateCartClose(){
      cartEl.classList.remove('anim-in');
      cartEl.classList.add('anim-out');
      cartEl.setAttribute('aria-hidden','true');
      cartToggle.setAttribute('aria-expanded','false');
      setTimeout(()=> {
        if (cartEl.classList.contains('anim-out')) {
          cartEl.classList.add('hidden');
          cartEl.classList.remove('anim-out');
          cartEl.style.display = 'none';
        }
      }, 260);
    }
    // keep original named functions behavior for compatibility
    function openCart(){ animateCartOpen(); }
    function closeCart(){ animateCartClose(); }
    function toggleCart(){ if(cartEl.classList.contains('hidden')) animateCartOpen(); else animateCartClose(); }

    cartToggle.addEventListener('click', toggleCart);
    cartCloseFooter.addEventListener('click', closeCart);
    checkoutBtn.addEventListener('click', checkoutWhatsApp);

    window.addEventListener('storage', (e) => {
      if(e.key === 'cart' || e.key === 'cart_last_update'){
        try { cart = JSON.parse(localStorage.getItem('cart') || '[]'); } catch(err){ cart = []; }
        renderCart();
        updateCartCount();
        // bump visual feedback for cart change
        triggerCartBump();
      }
    });

    // WhatsApp checkout
        function checkoutWhatsApp() { if (cart.length === 0) { alert('Cart is empty.'); return; } let text = 'Order request — items:\n\n'; cart.forEach(it => text += `${it.name} — QAR ${it.price} × ${it.quantity}\n`); const subtotal = cart.reduce((s,i)=> s + (Number(i.price)||0) * i.quantity, 0); const shipping = subtotal > 0 ? 10 : 0; text += `\nSubtotal: QAR ${subtotal.toFixed(2)}\nShipping: QAR ${shipping.toFixed(2)}\nTotal: QAR ${(subtotal+shipping).toFixed(2)}`; const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`; window.open(url, '_blank'); }


    // Product loader (same as before), thumbnails limited to 3 + overlay + popup viewer
    async function loadProduct(){
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      if(!id){ document.getElementById('product-area').innerHTML = '<div>Product ID missing</div>'; return; }
      const { data, error } = await supabase.from('products').select('*').eq('id', id).single();
      if(error || !data){ document.getElementById('product-area').innerHTML = '<div>Product not found</div>'; return; }
      const p = data;
      window.__currentProduct = p; // store for "more products" queries
      const images = (p.image_urls && p.image_urls.length) ? p.image_urls : [''];
      const mainImg = images[0] || '';

      // render but only show up to 3 thumbnails; add overlay if more
      const html = `
        <div class="top">
          <div class="gallery">
            <div style="height:320px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#f8fbff">
              <img id="main-img" class="main-img product-image" src="${escapeHtml(mainImg)}" alt="" style="max-width:100%;max-height:100%;object-fit:contain"/>
            </div>
            <div class="thumbs" id="thumbs">
              ${images.slice(0,3).map((u,i)=>`<img src="${escapeHtml(u)}" class="${i===0 ? 'active':''}" data-i="${i}" />`).join('')}
              ${images.length > 3 ? `<div class="thumb-overlay" id="thumb-overlay">+${images.length - 3}</div>` : ''}
            </div>
          </div>
          <div class="info">
            <h2 style="margin:0">${escapeHtml(p.name)}</h2>
            <div style="font-size:13px;color:var(--muted);margin-top:6px">Category: ${escapeHtml(p.category||'Uncategorized')}</div>
            <div class="price">${formatPrice(p.price)}</div>
            <div style="margin-top:10px;color:var(--muted)">${escapeHtml(p.description||'No description')}</div>

            <div class="add-row">
              <div class="qty">
                <button id="dec">−</button>
                <input id="qty" value="1" style="width:48px;text-align:center;border:0;background:transparent;font-weight:700"/>
                <button id="inc">＋</button>
              </div>
              <button id="add-cart" class="btn-add">Add to Cart</button>
            </div>
          </div>
        </div>
      `;
      document.getElementById('product-area').innerHTML = html;

      // thumbnails - behavior: click updates main image (preserving shimmer), animate reveal by adding .in (do NOT set inline opacity)
      const thumbs = document.querySelectorAll('#thumbs img');
      thumbs.forEach((img, idx) => {
        // add small staggered reveal (do not set inline opacity - keep CSS-controlled)
        setTimeout(()=> img.classList.add('in'), 160 + idx * 80);

        img.addEventListener('click', (ev) => {
          ev.preventDefault();
          document.querySelectorAll('#thumbs img').forEach(x => x.classList.remove('active'));
          img.classList.add('active');
          const main = document.getElementById('main-img');
          main.classList.remove('in');
          // small delay to allow exit transition
          setTimeout(()=> {
            main.src = img.src;
            main.dataset.index = idx; // track index among visible thumbs
            // mark loading shimmer while new image loads
            main.setAttribute('data-loading','true');
          }, 80);
        });

        // (no dblclick) thumbnails only update main image on click
      });

      // overlay opens popup with full images list
      const overlay = document.getElementById('thumb-overlay');
      if(overlay){
        overlay.addEventListener('click', (ev) => {
          ev.stopPropagation();
          openFs(0); // open viewer starting at first image
        });
      }

      // main image: handle load -> show
      const mainImgEl = document.getElementById('main-img');
      mainImgEl.setAttribute('data-loading','true');
      mainImgEl.dataset.index = 0;
      mainImgEl.addEventListener('load', ()=>{
        mainImgEl.removeAttribute('data-loading');
        // entrance
        setTimeout(()=> mainImgEl.classList.add('in'), 80);
      });

      // clicking main image opens popup (single click)
      mainImgEl.addEventListener('click', () => {
        // find current index if available; otherwise 0
        const idx = Number(mainImgEl.dataset.index || 0);
        openFs(idx);
      });

      // info area entrance
      setTimeout(()=> document.querySelector('.info').classList.add('in'), 260);

      document.getElementById('inc').addEventListener('click', ()=>{ let q=+document.getElementById('qty').value||1; document.getElementById('qty').value = q+1; });
      document.getElementById('dec').addEventListener('click', ()=>{ let q=+document.getElementById('qty').value||1; if(q>1) document.getElementById('qty').value = q-1; });

      document.getElementById('add-cart').addEventListener('click', ()=> {
        const qty = Math.max(1, parseInt(document.getElementById('qty').value||'1'));
        const existing = cart.find(i=>i.id == p.id);
        if(existing) existing.quantity = Number(existing.quantity || 0) + qty;
        else cart.push({ id: p.id, name: p.name, price: Number(p.price)||0, quantity: qty, image: images[0]||'', link: window.location.href });
        saveCart();
        openCart();
      });

      // mark AI promo to animate in after product content
      setTimeout(()=> document.getElementById('aiPromo').classList.add('in'), 420);

      // navbar ready class for stagger
      requestAnimationFrame(()=> document.querySelector('.navbar').classList.add('ready'));

      // initialize the "more" pane after product loaded
      initMorePanel();

      // store images array for viewer usage
      window.__productImages = images.slice(); // clone
    }

    // --- POPUP VIEWER LOGIC ---
    const fsViewer = document.getElementById('fs-viewer');
    const fsImg = document.getElementById('fs-img');
    const fsCloseBtn = fsViewer.querySelector('.fs-close');
    const fsPrevBtn = fsViewer.querySelector('.fs-prev');
    const fsNextBtn = fsViewer.querySelector('.fs-next');
    let fsCurrent = 0;

    function openFs(index = 0){
      const imgs = window.__productImages || [''];
      if(!imgs || imgs.length === 0) return;
      fsCurrent = index || 0;
      if(fsCurrent < 0) fsCurrent = 0;
      if(fsCurrent >= imgs.length) fsCurrent = imgs.length - 1;
      fsImg.src = imgs[fsCurrent] || '';
      fsViewer.classList.add('visible');
      fsViewer.setAttribute('aria-hidden','false');
      // focus for keyboard controls
      fsCloseBtn.focus();
      document.addEventListener('keydown', fsKeyHandler);
    }
    function closeFs(){
      fsViewer.classList.remove('visible');
      fsViewer.setAttribute('aria-hidden','true');
      fsImg.src = '';
      document.removeEventListener('keydown', fsKeyHandler);
    }
    function showFs(i){
      const imgs = window.__productImages || [''];
      if(imgs.length === 0) return;
      fsCurrent = (i + imgs.length) % imgs.length;
      fsImg.src = imgs[fsCurrent] || '';
    }
    function fsKeyHandler(e){
      if(e.key === 'Escape'){ closeFs(); return; }
      if(e.key === 'ArrowLeft'){ showFs(fsCurrent - 1); return; }
      if(e.key === 'ArrowRight'){ showFs(fsCurrent + 1); return; }
    }
    fsCloseBtn.addEventListener('click', closeFs);
    fsPrevBtn.addEventListener('click', ()=> showFs(fsCurrent - 1));
    fsNextBtn.addEventListener('click', ()=> showFs(fsCurrent + 1));
    // click outside card closes (on background)
    fsViewer.querySelector('.fs-bg').addEventListener('click', closeFs);

    // Expose minimal addToCart for quick interactions (used by more-grid)
    function addToCart(p) {
      let found = cart.find(i => i.id === p.id);
      if (found) {
        found.quantity = Number(found.quantity || 0) + 1;
      } else {
        cart.push({
          id: p.id,
          name: p.name || 'Product',
          price: Number(p.price) || 0,
          quantity: 1,
          image: p.image || '',
          link: `product.html?id=${p.id}`
        });
      }
      saveCart();
      // show cart briefly if you want:
      // openCart();
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"'`=\/]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#x60;','/':'&#x2F;'}[c])); }

    // initial render
    try { cart = JSON.parse(localStorage.getItem('cart') || '[]'); } catch(err){ cart = []; }
    renderCart();
    updateCartCount();
    loadProduct();

    /* ---------------------------
       Extra small UX polish:
       - bump cart-toggle when cart count changes
       - small exit animation when user uses the "Go Back" control (plays then navigates)
       --------------------------- */

    // bump function
    function triggerCartBump(){
      cartToggle.classList.remove('bump');
      void cartToggle.offsetWidth;
      cartToggle.classList.add('bump');
      setTimeout(()=> cartToggle.classList.remove('bump'), 900);
    }

    // watch cart count changes (MutationObserver)
    (function watchCartCount(){
      const countNode = cartToggle.querySelector('.count');
      if(!countNode) return;
      const mo = new MutationObserver(() => {
        triggerCartBump();
      });
      mo.observe(countNode, { childList: true, characterData: true, subtree: true });
    })();

    // Add small exit animation for the "Go Back" control while preserving its logic.
    (function enhanceGoBack(){
      const anchors = Array.from(document.querySelectorAll('.wrap a'));
      const goBack = anchors.find(a => a.textContent && a.textContent.trim().startsWith('←'));
      if(!goBack) return;
      goBack.addEventListener('click', function(e){
        e.preventDefault();
        document.documentElement.classList.add('page-exit');
        const prod = document.getElementById('product-area');
        if(prod) prod.style.pointerEvents = 'none';
        setTimeout(()=> {
          try {
            if (history.length > 1) history.back();
            else window.location.href = 'index.html';
          } catch(err) {
            window.location.href = 'index.html';
          }
        }, 420);
      }, { capture: true });
    })();

    // Respect reduced-motion: if user prefers reduced motion, skip animations instantly
    if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
      document.querySelectorAll('.thumbs img, .info, .gallery .main-img, .ai-promo').forEach(el => el.classList.add('in'));
      document.querySelector('.navbar') && document.querySelector('.navbar').classList.add('ready');
    }

    /* -----------------------------
       NEW: "More products" interactive system
       - three views: category / trending / suggested
       - client-side paging (Load more)
       - reuses supabase client, excludes current product
       - animated reveal + navigation
       ----------------------------- */

    const moreGrid = document.getElementById('moreGrid');
    const moreLoadBtn = document.getElementById('moreLoadBtn');
    const tabs = Array.from(document.querySelectorAll('.more-controls .tab'));

    let moreState = {
      view: 'category', // category | trending | suggested
      page: 0,
      pageSize: 6,
      loading: false,
      exhausted: false, // no more results
      lastQuerySnapshot: null
    };

    function setActiveTab(view) {
      moreState.view = view;
      moreState.page = 0;
      moreState.exhausted = false;
      tabs.forEach(t => t.classList.toggle('active', t.dataset.view === view));
      // clear grid & load
      moreGrid.innerHTML = '';
      loadMoreProducts({ reset: true });
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', ()=> setActiveTab(tab.dataset.view));
      tab.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab(tab.dataset.view); }
      });
    });

    moreLoadBtn.addEventListener('click', () => loadMoreProducts({ append: true }));

    async function loadMoreProducts({ append = false, reset = false } = {}) {
      if (moreState.loading) return;
      moreState.loading = true;
      moreLoadBtn.textContent = 'Loading...';
      moreLoadBtn.disabled = true;

      const currentProduct = window.__currentProduct || {};
      const page = append ? moreState.page + 1 : 0;
      const limit = moreState.pageSize;
      const offset = page * limit;

      try {
        let query = supabase.from('products').select('*');

        // Exclude current product id
        if (currentProduct.id) query = query.neq('id', currentProduct.id);

        // Choose ordering / filters per view
        if (moreState.view === 'category') {
          if (currentProduct.category) {
            query = query.eq('category', currentProduct.category);
          } else {
            // fallback to latest
            query = query.order('created_at', { ascending: false });
          }
        } else if (moreState.view === 'trending') {
          // heuristic for trending: sort by popular-ish fields if present (e.g. created_at desc)
          // if you have a "popularity" column use that instead
          query = query.order('created_at', { ascending: false });
        } else { // suggested
          // suggested: similar category first, then other recent
          if (currentProduct.category) {
            // we'll first fetch matching category (handled by primary query below)
            query = query.order('created_at', { ascending: false });
          } else {
            query = query.order('created_at', { ascending: false });
          }
        }

        // pagination: use range for supabase
        const from = offset;
        const to = offset + limit - 1;
        const { data, error } = await query.range(from, to);

        if (error) {
          console.error('Error loading more products', error);
          showMoreEmpty('Failed to load products.');
          moreState.exhausted = true;
        } else if (!data || data.length === 0) {
          if (!append) showMoreEmpty('No more products found.');
          moreState.exhausted = true;
        } else {
          // Render results (append or replace)
          renderMoreProducts(data, { append, page });
          moreState.page = page;
          if (data.length < limit) moreState.exhausted = true;
        }
      } catch (err) {
        console.error(err);
        showMoreEmpty('Failed to load products.');
        moreState.exhausted = true;
      } finally {
        moreState.loading = false;
        moreLoadBtn.textContent = moreState.exhausted ? 'No more' : 'Load more';
        moreLoadBtn.disabled = moreState.exhausted;
      }
    }

    function showMoreEmpty(msg) {
      moreGrid.innerHTML = `<div class="more-empty">${escapeHtml(msg)}</div>`;
    }

    function renderMoreProducts(items, { append = false, page = 0 } = {}) {
      if (!append) moreGrid.innerHTML = '';
      // create card elements with staggered reveal
      items.forEach((p, idx) => {
        const card = document.createElement('div');
        card.className = 'more-card';
        card.innerHTML = `
          <div class="thumb"><img src="${escapeHtml((p.image_urls && p.image_urls[0]) ? p.image_urls[0] : '')}" alt="${escapeHtml(p.name)}" /></div>
          <div class="title">${escapeHtml(p.name || 'Product')}</div>
          <div class="price">${formatPrice(p.price)}</div>
        `;
        // click behaviour: animate exit then navigate
        card.addEventListener('click', (e) => {
          e.stopPropagation();
          // play page exit then navigate
          document.documentElement.classList.add('page-exit');
          setTimeout(()=> { window.location.href = `product.html?id=${p.id}`; }, 360);
        });

        // add "add to cart" hover quick action (interaction only): reveal small button
        const quickBtn = document.createElement('button');
        quickBtn.textContent = 'Add';
        quickBtn.style.position = 'absolute';
        quickBtn.style.right = '12px';
        quickBtn.style.bottom = '12px';
        quickBtn.style.padding = '6px 8px';
        quickBtn.style.borderRadius = '8px';
        quickBtn.style.border = 'none';
        quickBtn.style.background = 'rgba(0,0,0,0.06)';
        quickBtn.style.fontWeight = '700';
        quickBtn.style.cursor = 'pointer';
        quickBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          addToCart({
            id: p.id,
            name: p.name,
            price: Number(p.price)||0,
            image: (p.image_urls && p.image_urls[0]) ? p.image_urls[0] : ''
          });
          showMiniToast('Added to cart');
          triggerCartBump();
        });
        // position container
        card.style.position = 'relative';
        // hide button until hover
        quickBtn.style.opacity = '0';
        quickBtn.style.transition = 'opacity 220ms var(--easing)';
        card.addEventListener('mouseenter', ()=> quickBtn.style.opacity = '1');
        card.addEventListener('mouseleave', ()=> quickBtn.style.opacity = '0');
        card.appendChild(quickBtn);

        moreGrid.appendChild(card);

        // staggered reveal
        setTimeout(()=> card.classList.add('in'), 120 + idx * 80 + page * (moreState.pageSize * 40));
      });
    }

    function showMiniToast(text) {
      const t = document.createElement('div');
      t.textContent = text;
      Object.assign(t.style, {
        position: 'fixed',
        bottom: '86px',
        right: '20px',
        background: '#143047',
        color: '#fff',
        padding: '8px 12px',
        borderRadius: '8px',
        zIndex: 9999,
        opacity: '0',
        transform: 'translateY(8px)',
        transition: 'opacity 260ms var(--easing), transform 260ms var(--easing)'
      });
      document.body.appendChild(t);
      requestAnimationFrame(()=> { t.style.opacity = '1'; t.style.transform = 'translateY(0)'; });
      setTimeout(()=> {
        t.style.opacity = '0'; t.style.transform = 'translateY(8px)';
        setTimeout(()=> t.remove(), 300);
      }, 1200);
    }

    // Initialize more panel once product is loaded
    function initMorePanel(){
      // default tab = category
      setActiveTab('category');

      // keyboard shortcut: press 'm' to focus Load more
      document.addEventListener('keydown', (e) => {
        if (e.key === 'm' && document.activeElement.tagName.toLowerCase() !== 'input') {
          moreLoadBtn.focus();
        }
      });
    }

    // small util: remove page-exit stuck state when navigating back (bfcache)
    window.addEventListener('pageshow', (ev) => {
      document.documentElement.classList.remove('page-exit');
      document.querySelectorAll('.more-card.in').forEach(c => c.classList.add('in'));
    });

    // For safety, if user prefers reduced motion reveal everything quickly
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      document.querySelectorAll('.more-card').forEach(c => c.classList.add('in'));
    }

  </script>
</body>
</html>
