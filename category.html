<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rongtuli-Categorie</title>

 <style>
  /* Make sizing predictable */
  *,
  *::before,
  *::after { box-sizing: border-box; }

  body { font-family: "Poppins", sans-serif; background-color: #f6f8fb; margin:0; padding:0; }
  .header { display:flex; justify-content:center; align-items:center; padding:1rem 0; }
  .logo{ height:90px; }
  .navbar { background-color:#dce4cc; display:flex; justify-content:center; flex-wrap:wrap; gap:2rem; padding:0.7rem 1rem; border-radius:13px; margin:0 auto; width:fit-content; }
  .navbar a{ text-decoration:none; font-weight:600; color:#415a4a; }

  :root{
    --card:#ffffff;
    --accent:#6aa8d6;
    --accent-dark:#6aa8d6;
    --muted:#7b8794;
    --text:#7092b0;
    --radius:14px;
    --card-radius:12px;
    --shadow: 0 8px 26px rgba(16,24,40,0.06);
    --soft-shadow: 0 6px 18px rgba(15,30,40,0.06);
    --cart-width:340px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  .wrap { max-width:1000px; margin:18px auto; padding:0 16px; }
  h1.category-title { font-weight:800; color:var(--text); margin:8px 0 12px 0; text-align:left; }

  /* grid of all products: responsive, no big gaps */
  .products-grid {
    display: grid;
    gap: 18px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    align-items: start;
  }

  .product-card {
    background:var(--card);
    border-radius:var(--card-radius);
    padding:14px;
    text-align:center;
    box-shadow:var(--soft-shadow);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    transition:transform .18s, box-shadow .18s;
    cursor:pointer;
  }
  .product-card:hover { transform:translateY(-6px); box-shadow: 0 18px 40px rgba(16,24,40,0.12); }

  .product-image { width:100%; max-width:260px; height:140px; object-fit:cover; border-radius:10px; box-shadow:0 6px 18px rgba(16,24,40,0.05), inset 0 1px 0 rgba(255,255,255,0.4); background:linear-gradient(180deg,#f8fbff,#fff); }
  .product-name{ color:#7092b0; font-weight:800; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:220px; }
  .product-price{ color:var(--text); font-weight:800; font-size:18px; }
  .add-btn{ background:linear-gradient(180deg,var(--accent),var(--accent-dark)); color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:800; width:100%; box-shadow:0 8px 18px rgba(106,168,214,0.16); }
  footer{max-width:1000px;margin:28px auto;text-align:center;color:var(--muted)}

  /* Cart toggle and panel */
  /* Modern minimalist cart toggle */
  #cart-toggle {
    position: fixed;
    right: 22px;
    top: 22px;
    background: var(--accent);
    color: #fff;
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: 0.3px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
    cursor: pointer;
    z-index: 11001; /* high to avoid overlap */
    display: flex;
    align-items: center;
    gap: 6px;
    border: none;
    transition: all 0.25s ease;
  }

  #cart-toggle:hover {
    background: var(--accent-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
  }

  #cart-toggle .count {
    background: #fff;
    color: var(--accent-dark);
    padding: 2px 8px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 12px;
  }

  /* Cart panel (clean + soft aesthetic) */
  #cart {
    position: fixed;
    right: 22px;
    top: 70px;
    width: var(--cart-width);
    max-height: calc(100vh - 96px);
    overflow: auto;
    background: #fff;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.12);
    z-index: 11000;
    transition: transform 0.25s ease, opacity 0.25s ease;
    /* ensure proper rendering on mobile */
    -webkit-overflow-scrolling: touch;
  }

  #cart.hidden {
    transform: translateY(-10px) scale(0.98);
    opacity: 0;
    pointer-events: none;
    display: none;
  }

  #cart h2 {
    margin: 0 0 12px 0;
    color: var(--text);
    font-size: 16px;
    font-weight: 700;
  }

  /* Cart item rows */
  #cart-rows > div {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  }

  /* optional utility class for rows (if you add it in JS) */
  .cart-row { display:flex; align-items:center; gap:10px; padding:8px 0; }

  #cart-rows img {
    width: 56px;
    height: 56px;
    object-fit: cover;
    border-radius: 10px;
  }

  /* Buttons inside cart */
  #cart .small-btn {
    border: none;
    background: transparent;
    cursor: pointer;
    font-weight: 600;
    color: var(--accent);
    transition: color 0.2s ease;
  }

  #cart .small-btn:hover {
    color: var(--accent-dark);
  }

  /* Actions */
  .cart-actions {
    display: flex;
    gap: 8px;
    margin-top: 14px;
    justify-content: flex-end;
  }

  #subtotal,
  #shipping,
  #total {
    margin: 8px 0;
    font-weight: 600;
    color: var(--muted);
    font-size: 14px;
  }

  #total {
    color: var(--text);
    font-size: 16px;
  }

  /* --------------------------------------------------------------------
     Responsive: safer & cleaner mobile cart
     We pin cart between left and right (avoid forced width + right only).
     Respect safe-area insets for notches.
     -------------------------------------------------------------------- */

  @media (max-width: 900px) {
    #cart {
      /* pin left & right so the browser calculates width reliably */
      left:50              px !important;
      right:  px;
      width: auto;
      max-width: calc(100% - 24px);
      top: auto;
      bottom: 90px;
      transform: none; /* avoid transform clipping quirks */
      border-radius: 12px;
      /* reduce max height a bit on mobile */
      max-height: calc(100vh - 120px);
    }

    #cart-toggle {
      bottom: 22px;
      top: auto;
      right: 12px;
      left: auto;
      padding: 12px 16px;
    }
  }

  @media (max-width: 600px) {
    /* respect safe area on modern phones and reduce paddings */
    #cart {
      max-height: calc(100vh - 140px);
      padding: calc(12px + env(safe-area-inset-top)) calc(12px + env(safe-area-inset-right)) calc(12px + env(safe-area-inset-bottom));
      left: 8px;
      right: 8px;
      bottom: 88px;
      border-radius: 12px;
    }

    /* if your JS sets .cart-row classes, these help; otherwise #cart-rows > div rules still apply */
    #cart .cart-row { gap: 10px; padding: 8px 0; min-height: 48px; }
    #cart img { width: 48px; height: 48px; flex: 0 0 48px; }
    .small-btn { padding: 6px 6px; font-size: 12px; }
  }

  @media (max-width: 400px) {
    /* Very narrow phones: make tighter but usable */
    #cart { padding: 10px; left: 6px; right: 6px; bottom: 80px; }
    #cart h2 { font-size: 16px; }
    #cart .cart-text > div:first-child { font-size: 13px; }
    .product-name { max-width: 160px; }
  }


   /* AI search promo block (place before footer) */
.ai-promo {
  background: #fff;
  border-radius: 12px;
  padding: 18px;
  margin: 28px auto;
  box-shadow: 0 10px 30px rgba(16,24,40,0.06);
  max-width: 970px;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  border: 1px solid #eef6fb;
}
.ai-promo .left {
  display: flex;
  gap: 12px;
  align-items: center;
}
.ai-promo .left .icon {
  width: 56px;
  height: 56px;
  border-radius: 10px;
  background:#6aa7d628;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: #7092b0;
  font-size: 20px;
}
.ai-promo h3 { margin: 0; font-size: 16px; font-weight: 800; color:#7092b0; }
.ai-promo p { margin: 2px 0 0 0; color:var(--muted); font-size:13px; }
.ai-promo .ai-btn {
  background: #6aa8d6;
  color: #fff;
  border: 0;
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 8px 18px rgba(106,168,214,0.16);
}
/* Improved mobile layout for .ai-promo */
@media (max-width:720px) {
  .ai-promo {
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 14px;
    gap: 12px;
    margin: 20px 12px;        /* keep some side inset on small screens */
  }

  /* keep icon + text row on small tablets, but tighter */
  .ai-promo .left {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .ai-promo .left .icon {
    width: 48px;
    height: 48px;
    font-size: 18px;
    flex: 0 0 48px;
  }

  .ai-promo h3 {
    margin: 0;
    font-size: 15px;
    line-height: 1.15;
  }

  .ai-promo p {
    margin: 4px 0 0 0;
    font-size: 13px;
    color: var(--muted);
  }

  /* CTA full width, but not flush to page edges */
  .ai-promo .ai-btn {
    display: block;
    width: calc(100% - 24px);
    max-width: 420px;
    margin: 6px auto 0;
    padding: 12px 14px;
    font-size: 15px;
  }
}

/* Extra tweak for very small phones: icon above text */
@media (max-width:420px) {
  .ai-promo .left {
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }

  .ai-promo .left .icon {
    width: 56px;
    height: 56px;
    font-size: 20px;
  }

  .ai-promo { padding: 12px; gap: 10px; margin: 16px 10px; }
  .ai-promo .ai-btn { width: 100%; padding: 12px; }
}


  /* Helpful debugging utility (uncomment while testing) */
  /* #cart { outline: 2px dashed rgba(255,0,0,0.15); } */

</style>

</head>
<body>

  <header class="header"><a href="index.html">
  <img src="assets/logo.png" alt="Rongtuli Logo" class="logo" />
</a></header>
  <nav class="navbar">
    <a href="index.html">Sarees</a>
    <a href="index.html">Creams</a>

    <a href="index.html">Hair Bands</a>
  </nav>

  <div class="wrap">
<a href="#" 
   style="text-decoration:none;color:var(--muted)" 
   onclick="(function(e){
     e.preventDefault();
     try {
       // if there's a previous page in history -> go back
       if (history.length > 1) {
         history.back();
       } else {
         // fallback if opened directly / no history
         window.location.href = 'index.html';
       }
     } catch(err) {
       // fallback on error
       window.location.href = 'index.html';
     }
   })(event);">
  ← Go Back
</a>
    <h1 id="category-title" class="category-title">Category</h1>
    <div id="products-grid" class="products-grid">Loading...</div>

    <!-- AI search promo: "Can't find what you want?" -->
<div class="ai-promo" id="aiPromo">
  <div class="left">
    <div class="icon">AI</div>
    <div>
      <h3>Can't find what you want?</h3>
      <p>Try our smart AI search — describe what you need in plain words and we’ll suggest products.</p>
    </div>
  </div>

  <div>
    <button class="ai-btn" id="openAISearch">Try AI Search</button>
  </div>
  
</div>
     <footer id="foot">© <span id="year"></span> Rongtuli</footer>
  </div>

  <button id="cart-toggle" aria-expanded="false" title="Open cart">Cart <span class="count">0</span></button>
  <div id="cart" class="hidden" aria-hidden="true">
    <h2>Your Cart</h2>
    <div id="cart-rows"></div>
    <p id="subtotal"></p>
    <p id="shipping"></p>
    <p id="total"></p>
    <div class="cart-actions">
      <button id="checkout-btn" class="add-btn" style="width:auto;padding:8px 12px;">Checkout via WhatsApp</button>
      <button id="cart-close" class="small-btn">Close</button>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const SUPABASE_URL      = 'https://qhslurjvanppitwuuxtv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoc2x1cmp2YW5wcGl0d3V1eHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NTg0MjEsImV4cCI6MjA3NjUzNDQyMX0.8PNOewgJFDGVVIDdiEbdFE2x9Yzv29o2kdAANqaW1gA';
    const WHATSAPP_NUMBER   = '97451707046';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const params = new URLSearchParams(window.location.search);
    const catName = params.get('name') || '';
    document.getElementById('category-title').textContent = catName || 'Category';

    const productsGrid = document.getElementById('products-grid');
    const cartEl = document.getElementById('cart');
    const cartRows = document.getElementById('cart-rows');
    const subtotalEl = document.getElementById('subtotal');
    const shippingEl = document.getElementById('shipping');
    const totalEl = document.getElementById('total');
    const cartToggle = document.getElementById('cart-toggle');

    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    function formatPrice(n) { return 'QAR ' + (Number(n) || 0).toFixed(2); }
    function saveCart() { localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); updateCartCount(); }
    function updateCartCount() { const countSpan = cartToggle.querySelector('.count'); const qty = cart.reduce((s,i)=> s + (Number(i.quantity)||0), 0); countSpan.textContent = qty; cartToggle.setAttribute('aria-label', `Open cart — ${qty} items`); }

            document.getElementById('year').textContent = new Date().getFullYear();

    async function loadCategory() {
      productsGrid.textContent = 'Loading...';
      const { data, error } = await supabase.from('products').select('*').eq('category', catName).order('created_at', { ascending:false });
      if (error) { productsGrid.textContent = 'Error loading category.'; console.error(error); return; }
      if (!data || data.length === 0) { productsGrid.innerHTML = '<div class="small">No products in this category.</div>'; return; }


      document.getElementById('openAISearch').addEventListener('click', function () {
  window.location.href = 'search.html';
});
      productsGrid.innerHTML = '';
      data.forEach(p => {
        const imgSrc = (p.image_urls && p.image_urls.length) ? p.image_urls[0] : '';
        const card = document.createElement('div');
        card.className = 'product-card';
        card.addEventListener('click', () => { window.location.href = `product.html?id=${p.id}`; });

        const image = document.createElement('img'); image.className = 'product-image'; image.src = imgSrc || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="360" height="240"><rect width="100%" height="100%" fill="%23eee"/></svg>'; image.alt = p.name || 'product';
        const name = document.createElement('div'); name.className = 'product-name'; name.textContent = p.name || 'Product';
        const price = document.createElement('div'); price.className = 'product-price'; price.textContent = (p.price !== undefined && p.price !== null) ? `${p.price} QR` : '—';

        const addBtn = document.createElement('button');
        addBtn.className = 'add-btn';
        addBtn.textContent = 'Add to Cart';
        addBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const existing = cart.find(i => i.id === p.id);
          if (existing) existing.quantity++;
          else cart.push({ id: p.id, name: p.name, price: Number(p.price)||0, image: imgSrc || '', quantity: 1, link: `${window.location.origin}/product.html?id=${p.id}` });
          saveCart();
          openCart();
        });

        card.appendChild(image);
        card.appendChild(name);
        card.appendChild(price);
        card.appendChild(addBtn);
        productsGrid.appendChild(card);
      });
    }

    function renderCart() {
      cartRows.innerHTML = '';
      if (cart.length === 0) {
        cartRows.textContent = 'Cart is empty.';
      } else {
        cart.forEach((it, i) => {
          const row = document.createElement('div');
          const img = document.createElement('img'); img.src = it.image || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect width="100%" height="100%" fill="%23eee"/></svg>'; img.alt = it.name;
          const txt = document.createElement('div'); txt.style.flex = '1'; txt.innerHTML = `<div style="font-weight:800">${it.name}</div><div style="font-size:13px;color:var(--muted)">${formatPrice(it.price)} × ${it.quantity}</div>`;
          const controls = document.createElement('div'); controls.style.display='flex'; controls.style.flexDirection='column'; controls.style.gap='6px'; controls.style.alignItems='flex-end';
          const inc = document.createElement('button'); inc.className='small-btn'; inc.textContent='+'; inc.addEventListener('click', ()=>{ cart[i].quantity++; saveCart(); });
          const dec = document.createElement('button'); dec.className='small-btn'; dec.textContent='-'; dec.addEventListener('click', ()=>{ if(cart[i].quantity>1) cart[i].quantity--; else cart.splice(i,1); saveCart(); });
          const rem = document.createElement('button'); rem.className='small-btn'; rem.textContent='Remove'; rem.addEventListener('click', ()=>{ cart.splice(i,1); saveCart(); });
          controls.appendChild(inc); controls.appendChild(dec); controls.appendChild(rem);
          row.appendChild(img); row.appendChild(txt); row.appendChild(controls);
          cartRows.appendChild(row);
        });
      }
      const subtotal = cart.reduce((s,i)=> s + (Number(i.price)||0) * i.quantity, 0);
      const shipping = subtotal > 0 ? 10 : 0;
      subtotalEl.textContent = 'Subtotal: ' + formatPrice(subtotal);
      shippingEl.textContent = 'Shipping: ' + formatPrice(shipping);
      totalEl.textContent = 'Total: ' + formatPrice(subtotal + shipping);
    }

    function checkoutWhatsApp() { if (cart.length === 0) { alert('Cart is empty.'); return; } let text = 'Order request — items:\n\n'; cart.forEach(it => text += `${it.name} — QAR ${it.price} × ${it.quantity}\n`); const subtotal = cart.reduce((s,i)=> s + (Number(i.price)||0) * i.quantity, 0); const shipping = subtotal > 0 ? 10 : 0; text += `\nSubtotal: QAR ${subtotal.toFixed(2)}\nShipping: QAR ${shipping.toFixed(2)}\nTotal: QAR ${(subtotal+shipping).toFixed(2)}`; const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`; window.open(url, '_blank'); }

    function openCart() { cartEl.classList.remove('hidden'); cartEl.style.display='block'; cartEl.setAttribute('aria-hidden','false'); cartToggle.setAttribute('aria-expanded','true'); }
    function closeCart() { cartEl.classList.add('hidden'); cartEl.setAttribute('aria-hidden','true'); cartToggle.setAttribute('aria-expanded','false'); setTimeout(()=>{ if(cartEl.classList.contains('hidden')) cartEl.style.display='none'; },220); }
    function toggleCart() { if(cartEl.classList.contains('hidden')) openCart(); else closeCart(); }

    document.getElementById('checkout-btn').addEventListener('click', checkoutWhatsApp);
    document.getElementById('cart-close').addEventListener('click', closeCart);
    document.getElementById('cart-toggle').addEventListener('click', toggleCart);

    renderCart();
    updateCartCount();
    loadCategory();


  </script>
</body>
</html>
